<div class="conversation-container">
  <div class="seller-home-header">
    <div>
      <h1>Conversation</h1>
      <p class="header-subtitle">
        About: <%= link_to @conversation.listing.title, @conversation.listing, class: "listing-link" %>
      </p>
    </div>
    <div>
      <%= link_to conversations_path, class: "btn btn-primary" do %>
        <svg class="btn-icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path fill-rule="evenodd" d="M11.03 3.97a.75.75 0 010 1.06l-6.22 6.22H21a.75.75 0 010 1.5H4.81l6.22 6.22a.75.75 0 11-1.06 1.06l-7.5-7.5a.75.75 0 010-1.06l7.5-7.5a.75.75 0 011.06 0z" clip-rule="evenodd" />
        </svg>
        <span>Back to Messages</span>
      <% end %>
    </div>
  </div>

  <div class="conversation-info">
    <div class="info-card">
      <h3>Conversation Details</h3>
      <div class="info-grid">
        <div class="info-item">
          <span class="info-label">Listing:</span>
          <span class="info-value"><%= link_to @conversation.listing.title, @conversation.listing, class: "info-link" %></span>
        </div>
        <div class="info-item">
          <span class="info-label">Price:</span>
          <span class="info-value"><%= number_to_currency(@conversation.listing.price) %></span>
        </div>
        <div class="info-item">
          <span class="info-label">Buyer:</span>
          <span class="info-value"><%= @conversation.buyer.email %></span>
        </div>
        <div class="info-item">
          <span class="info-label">Seller:</span>
          <span class="info-value"><%= @conversation.seller.email %></span>
        </div>
      </div>
    </div>
  </div>

  <div class="chat-container">
    <div class="messages-header">
      <h2>Messages</h2>
    </div>

    <div class="messages-list" id="messages">
      <% if @conversation.messages.empty? %>
        <div class="empty-chat">
          <p>No messages yet. Start the conversation!</p>
        </div>
      <% else %>
        <% @conversation.messages.each do |message| %>
          <div class="message <%= message.user == current_user ? 'message-sent' : 'message-received' %>">
            <div class="message-header">
              <span class="message-sender"><%= message.user.email %></span>
              <span class="message-time"><%= message.created_at.strftime("%b %d, %I:%M %p") if message.created_at %></span>
            </div>
            <div class="message-content">
              <%= message.content %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>

    <div class="message-form">
      <%= form_with model: [@conversation, Message.new], local: true, class: "message-form-inner" do |form| %>
        <div class="form-group">
          <%= form.label :content, "Your message:", class: "form-label" %>
          <%= form.text_area :content, rows: 3, class: "form-textarea", placeholder: "Type your message here..." %>
        </div>
        <div class="form-actions">
          <%= form.submit "Send Message", class: "btn btn-primary" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<style>
.conversation-container {
    padding: 2rem;
    max-width: 1600px;
    margin: 0 auto;
    min-height: calc(100vh - 80px);

    @media (max-width: 768px) {
        padding: 1rem;
    }
    
    .seller-home-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }
    
    .seller-home-header h1 {
        font-size: 2.5rem;
        margin: 0 0 4px 0;
        color: #333;
    }
    
    .header-subtitle {
        color: var(--color-gray-500);
        font-size: 1rem;
        margin: 0;
    }
    
    /* Icon sizing */
    .btn-icon-sm {
        width: 16px;
        height: 16px;
    }
    
    /* Conversation info card */
    .conversation-info {
        margin-bottom: 30px;
    }
    
    .info-card {
        background: white;
        padding: 24px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .info-card h3 {
        margin: 0 0 20px 0;
        color: #333;
        font-size: 1.25rem;
    }
    
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
    }
    
    .info-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }
    
    .info-label {
        font-size: 0.85rem;
        color: #666;
        font-weight: 500;
    }
    
    .info-value {
        font-size: 1rem;
        color: #333;
    }
    
    .info-link {
        color: #a7333f;
        text-decoration: none;
        font-weight: 500;
    }
    
    .info-link:hover {
        text-decoration: underline;
    }
    
    .listing-link {
        color: #a7333f;
        text-decoration: none;
        font-weight: 500;
    }
    
    .listing-link:hover {
        text-decoration: underline;
    }
    
    /* Chat container */
    .chat-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }
    
    .messages-header {
        padding: 20px 24px;
        border-bottom: 1px solid #eee;
        background: #f8f9fa;
    }
    
    .messages-header h2 {
        margin: 0;
        font-size: 1.25rem;
        color: #333;
    }
    
    .messages-list {
        padding: 24px;
        max-height: 500px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 16px;
    }
    
    .empty-chat {
        text-align: center;
        padding: 40px 20px;
        color: #666;
    }
    
    /* Message styling */
    .message {
        max-width: 70%;
    }
    
    .message-sent {
        margin-left: auto;
    }
    
    .message-received {
        margin-right: auto;
    }
    
    .message-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 4px;
        font-size: 0.85rem;
        gap: 8px;
    }
    
    .message-sent .message-header {
        flex-direction: row-reverse;
        
    }
    
    .message-sender {
        font-weight: 500;
        color: #333;
    }
    
    .message-time {
        color: #999;
        font-size: 0.8rem;
    }
    
    .message-content {
        padding: 12px 16px;
        border-radius: 12px;
        line-height: 1.5;
        word-wrap: break-word;
    }
    
    .message-sent .message-content {
        background: #a7333f;
        color: white;
        border-bottom-right-radius: 4px;
    }
    
    .message-received .message-content {
        background: #f0f2f5;
        color: #333;
        border-bottom-left-radius: 4px;
    }
    
    /* Message form */
    .message-form {
        border-top: 1px solid #eee;
        padding: 24px;
        background: #f8f9fa;
    }
    
    .message-form-inner {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }
    
    .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .form-label {
        font-weight: 500;
        color: #333;
        font-size: 0.9rem;
    }
    
    .form-textarea {
        padding: 12px;
        border: 1px solid #d0d0d0;
        border-radius: 8px;
        font-size: 1rem;
        resize: vertical;
        min-height: 80px;
        font-family: inherit;
    }
    
    .form-textarea:focus {
        outline: none;
        border-color: #a7333f;
        box-shadow: 0 0 0 2px rgba(167, 51, 63, 0.1);
    }
    
    .form-actions {
        display: flex;
        justify-content: flex-end;
    }
    
    /* Buttons */
    .btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 10px 16px;
        border-radius: 8px;
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 500;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .btn-primary {
        background-color: #a7333f;
        color: white;
    }
    
    .btn-primary:hover {
        background-color: #8b2a35;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .seller-home-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 16px;
        }
    
        .message {
            max-width: 85%;
        }
    
        .info-grid {
            grid-template-columns: 1fr;
        }
    }
}

</style>